!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.keyboardLink=n()}(this,function(){"use strict";function t(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}function n(t,n,e,o){return new(e||(e=Promise))(function(i,s){function r(t){try{c(o.next(t))}catch(t){s(t)}}function u(t){try{c(o.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(r,u)}c((o=o.apply(t,n||[])).next())})}function e(t,n){function e(t){return function(n){return o([t,n])}}function o(e){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,s&&(r=2&e[0]?s.return:e[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,e[1])).done)return r;switch(s=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,s=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(r=c.trys,!(r=r.length>0&&r[r.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){c.label=e[1];break}if(6===e[0]&&c.label<r[1]){c.label=r[1],r=e;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(e);break}r[2]&&c.ops.pop(),c.trys.pop();continue}e=n.call(t,c)}catch(t){e=[6,t],s=0}finally{i=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var i,s,r,u,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return u={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u}var o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},i=function(){function t(t){var o=t.host,i=t.port,s=this;this.content=function(){s.isConnect||(s.ws=new WebSocket(s.url),s.ws.onopen=function(){console.log("ws is connect"),s.isConnect=!0},s.ws.onmessage=function(t){s.receive(JSON.parse(t.data))},s.ws.onerror=function(){s.isConnect=!1},s.ws.onclose=function(){s.isConnect=!1,s.content()})},this.send=function(t){if(!s.ws||!s.isConnect)return{success:!1,msg:"ws not connect",data:null};var n=s.utilsGenerateId(),e=JSON.stringify({id:n,method:t.method,data:t.data});return s.ws.send(e),{success:!0,msg:null,data:null}},this.sendReceive=function(t){return n(s,void 0,void 0,function(){var n,o,i=this;return e(this,function(e){return this.ws&&this.isConnect?(n=this.utilsGenerateId(),o=JSON.stringify({id:n,method:t.method,data:t.data}),this.ws.send(o),[2,new Promise(function(t){i.messageCallbacks[n]=t})]):[2,{success:!1,msg:"ws not connect",data:null}]})})},this.receive=function(t){var n=t.id,e=t.callMethod,o=t.payload;n&&s.messageCallbacks[n]&&(s.messageCallbacks[n]({success:!0,msg:"OK",data:o}),delete s.messageCallbacks[n]),!n&&e&&s[e]&&s[e](t.payload)},this.utilsGenerateId=function(){return Date.now().toString()+"-"+Math.random().toString(36).substring(2)},this.ws=null,this.isConnect=!1,this.url=o+":"+i,this.messageCallbacks=new Map,this.content()}return t}(),s=function(o){function i(){var t=null!==o&&o.apply(this,arguments)||this;return t.sendActiveInputValue=function(n){t.send({method:"activeInputValue",data:n})},t.testSend=function(n){var e=n.method,o=n.data;t.send({method:e,data:o})},t.testSendReceive=function(o){return n(t,void 0,void 0,function(){return e(this,function(t){switch(t.label){case 0:return[4,this.sendReceive({method:"test",data:o})];case 1:return[2,t.sent()]}})})},t.handleTest=function(t){console.log("服务端调用测试自定义方法",t)},t}return t(i,o),i}(i);return function(){function t(t){var o=t.host,i=t.port,r=this;if(this.init=function(){return n(r,void 0,void 0,function(){return e(this,function(t){return document.addEventListener("focusin",this.focusInChange),document.addEventListener("focusout",this.focusOutChange),[2]})})},this.inputChange=function(t){r.ws&&r.ws.sendActiveInputValue(t.target.value||"")},this.focusInChange=function(){return n(r,void 0,void 0,function(){var t;return e(this,function(n){return t=document.activeElement,this.ws&&this.ws.sendActiveInputValue(t.value||""),this.nowElement=t,this.nowElement.addEventListener("input",this.inputChange),[2]})})},this.focusOutChange=function(){return n(r,void 0,void 0,function(){return e(this,function(t){return this.nowElement&&(this.nowElement.removeEventListener("input",this.inputChange),this.nowElement=null),[2]})})},!o||!i)throw new Error("host or port is null");this.host=o,this.port=i,this.ws=new s({host:this.host,port:this.port}),this.init()}return t}()});
